<script>
let provider;
let signer;
let contract;

const contractAddress = "PASTE_YOUR_CONTRACT_ADDRESS";
const abi = PASTE_YOUR_ABI;

async function connectWallet() {
  if (!window.ethereum) {
    alert("Open inside MetaMask browser");
    return;
  }

  provider = new ethers.providers.Web3Provider(window.ethereum);

  // ðŸ”¥ Auto switch to Sepolia
  try {
    await window.ethereum.request({
      method: "wallet_switchEthereumChain",
      params: [{ chainId: "0xaa36a7" }] // Sepolia
    });
  } catch (switchError) {
    alert("Please switch to Sepolia manually");
  }

  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  contract = new ethers.Contract(contractAddress, abi, signer);

  const address = await signer.getAddress();
  document.getElementById("address").innerText = "Address: " + address;

  refreshBalance();
}

async function refreshBalance() {
  const address = await signer.getAddress();
  const balance = await contract.balanceOf(address);
  document.getElementById("balance").innerText =
    "Token Balance: " + ethers.utils.formatUnits(balance, 18);
}

// ðŸ”¥ Mint
async function mintToken() {
  showLoading(true);
  try {
    const tx = await contract.mint();
    await tx.wait();
    alert("Mint Successful!");
    refreshBalance();
  } catch (err) {
    alert("Mint failed");
  }
  showLoading(false);
}

// ðŸ”¥ Transfer
async function transferToken() {
  const to = document.getElementById("toAddress").value;
  const amount = document.getElementById("amount").value;

  showLoading(true);
  try {
    const tx = await contract.transfer(
      to,
      ethers.utils.parseUnits(amount, 18)
    );
    await tx.wait();
    alert("Transfer Successful!");
    refreshBalance();
  } catch (err) {
    alert("Transfer failed");
  }
  showLoading(false);
}

// ðŸ”¥ Loading UI
function showLoading(state) {
  document.getElementById("loader").style.display =
    state ? "block" : "none";
}
</script>
